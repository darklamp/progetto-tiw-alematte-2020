<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Campaign detail</title>
    <link rel="stylesheet" type="text/css" href="../css/style.css" data-th-href="@{/css/style.css}">
    <script src="https://kit.fontawesome.com/4a39771299.js" crossorigin="anonymous"></script>
</head>
<body>
<div class="container">
    <div class="navbar">
        <a href="" class="disabled">Manager</a>
        <a href="managerHome.html" data-th-href="@{/manager}">Home</a>
        <a href="managerAccount.html" data-th-href="@{/profile}">Account</a>
        <div class="navbar-right">
            <a href="../index.html" data-th-href="@{/logout}">Logout</a>
        </div>
    </div>
    <div class="page-content">
        <h1><a href="managerHome.html" data-th-href="@{/manager}" class="btn btn-outline-secondary"><i class="fas fa-arrow-left"></i></a> Campaign: <span data-th-text="${campaign.getName()}"></span></h1>
        <div class="row">
            <div class="col-12">
                <div class="highlight">
                    <span style="float: right;" onclick="showForm();" data-th-if="${campaign.getState().equals('created')}"><i class="fas fa-pencil-alt" id="buttonInfoIcon"></i></span>
                    <div id="infoText"><p><strong>Campaign name: </strong><span data-th-text="${campaign.getName()}"></span></p>
                    <p><strong>Campaign client: </strong><span data-th-text="${campaign.getClient()}"></span></p></div>
                <div id="infoForm" style="display: none;">
                    <form class="form" method="POST" action="" data-th-action="@{/manager/campaignActions}">
                        <input type="hidden" name="campaignId" data-th-value="${campaign.getId()}"/>
                        <input type="hidden" name="action" value="modifyData"/>
                        <div class="row">
                            <div class="col-4">
                                <label>Campaign name</label>
                                <input type="text" class="form-control-bg-dark" name="campaignName" data-th-value="${campaign.getName()}"/>
                            </div>
                            <div class="col-4">
                                <label>Campaign client</label>
                                <input type="text" class="form-control-bg-dark" name="campaignClient" data-th-value="${campaign.getClient()}"/>
                            </div>
                            <div class="col-4">
                                <br/>
                                <input type="submit" class="btn btn-secondary" style="margin: 0 auto;" value="Update"/>
                            </div>
                        </div>
                    </form>
                </div>
                    <p><strong>Campaign status: </strong><span class="badge badge-warning" data-th-class="${'badge badge-' + campaign.getBadge()}" data-th-text="${campaign.getState().toUpperCase()}"></span></p>
                </div>
            </div>
        </div>
        <div class="row"><div class="col-12"><div class="alert alert-danger" data-th-class="${'alert alert-' + campaignAlert.getType()}" data-th-if="${campaignAlert.isVisible()}" data-th-utext="${campaignAlert.getContent()}">General error</div></div></div>
        <div class="row">
            <div class="col-8">
                <h2>Campaign images</h2>
                <div class="alert alert-primary" data-th-if="${not isImageAvailable}">Nothing to show</div>
                <div class="gallery" data-th-each="image : ${images}">
                    <a hraf=""><img src="../images/test1.jpg" data-th-src="${imagePath + image.getUrl()}" alt=""></a>
                </div>

            </div>
            <div class="col-4">
                <h2>Actions</h2>
                <a class="btn btn-outline-primary btn-full" id="newImageModalBtn" data-th-if="${campaign.getState().equals('created')}">Add new image</a> <br/>
                <a class="btn btn-outline-primary btn-full">Show images in map</a>
                <hr/>
                <a href="campaignDetail.html" class="btn btn-outline-success btn-full" data-th-href="@{/manager/campaignActions(campaignId=${campaign.getId()}, action='setStart')}" data-th-if="${campaign.getState().equals('created') && isImageAvailable}">Start campaign</a>
                <a href="campaignDetail.html" class="btn btn-outline-danger btn-full" data-th-href="@{/manager/campaignActions(campaignId=${campaign.getId()}, action='setClose')}" data-th-if="${campaign.getState().equals('started')}">Close campaign</a><br/>
                <a href="campaignDetail.html" class="btn btn-outline-info btn-full" data-th-href="@{/manager/campaignReport(campaignId=${campaign.getId()})}" data-th-if="${not campaign.getState().equals('created')}">Show report</a>
            </div>
        </div>
    </div>

    <!-- New image modal -->
    <div id="newImageModal" class="modal" data-th-if="${campaign.getState().equals('created')}">
        <!-- Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h2>Upload a new image</h2>
            </div>
            <div class="modal-body">
                <form class="form" method="POST" action="" data-th-action="@{/imageUploader}" enctype="multipart/form-data">
                    <input type="hidden" name="campaignId" value="" data-th-value="${campaign.getId()}"/>
                    <div class="form-group">
                        <div class="row">
                        <label>Image file</label>
                            <input type="file" class="form-control" name="image" required/>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-6">
                                <label>Latitude</label>
                                <input type="text" class="form-control" name="latitude" required/>
                            </div>
                            <div class="col-6">
                                <label>Longitude</label>
                                <input type="text" class="form-control" name="longitude" required/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-6">
                                <label>Resolution</label>
                                <input type="text" class="form-control" name="resolution" required/>
                            </div>
                            <div class="col-6">
                                <label>Source</label>
                                <input type="text" class="form-control" name="source" required/>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="row">
                            <div class="col-6">
                                <label>Region</label>
                                <input type="text" class="form-control" name="region" required/>
                            </div>
                            <div class="col-6">
                                <label>Town</label>
                                <input type="text" class="form-control" name="town" required/>
                            </div>
                        </div>
                    </div>
                    <input type="submit" class="btn btn-success" value="Upload"/>
                </form>
            </div>
        </div>
    </div> <!-- End new image modal-->

    <div class="footer">
        <div class="footer-content">(C) <a href="https://github.com/darklamp/progetto-tiw-alematte-2020">Project TIW</a> 2020</div>
    </div>
</div>

<script>
    // Get the modal
    var modal = document.getElementById("newImageModal");

    // Get the button that opens the modal
    var btn = document.getElementById("newImageModalBtn");

    // Get the <span> element that closes the modal
    var span = document.getElementsByClassName("close")[0];

    // When the user clicks the button, open the modal
    btn.onclick = function() {
        modal.style.display = "block";
    }

    // When the user clicks on <span> (x), close the modal
    span.onclick = function() {
        modal.style.display = "none";
    }

    // When the user clicks anywhere outside of the modal, close it
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }



    function showForm() {
        const infoForm = document.getElementById("infoForm");
        const infoText = document.getElementById("infoText");
        const buttonIcon = document.getElementById("buttonInfoIcon");
        if("none" === infoForm.style.display){
            infoText.style.display = "none";
            infoForm.style.display = "block";
            buttonIcon.className = "fas fa-times";
        } else {
            infoText.style.display = "block";
            infoForm.style.display = "none";
            buttonIcon.className = "fas fa-pencil-alt";
        }
    }


</script>

</body>
</html>